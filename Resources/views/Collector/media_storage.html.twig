{% extends app.request.isXmlHttpRequest ? 'WebProfilerBundle:Profiler:ajax_layout.html.twig' : 'WebProfilerBundle:Profiler:layout.html.twig' %}

{% block toolbar %}
    {% if collector.getLocated()|length or collector.getStored()|length %}
        {% set icon %}
            <img width="20" height="28" alt="MediaStorage" style="border-width: 0; vertical-align: middle; margin-right: 5px;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAYAAABh2p9gAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQRJREFUeNpi/P//PwM1ARMDlcGogZQDlpMnT7pxc3NbA9nhQKxOpL5rQLwJiPeBsI6Ozl+YBOOOHTv+AOllQNwtLS39F2owKYZ/gRq8G4i3ggxEToggWzvc3d2Pk+1lNL4fFAs6ODi8JzdS7mMRVyDVoAMHDsANdAPiOCC+jCQvQKqBQB/BDbwBxK5AHA3E/kB8nKJkA8TMQBwLxaBIKQbi70AvTADSBiSadwFXpCikpKQU8PDwkGTaly9fHFigkaKIJid4584dkiMFFI6jkTJII0WVmpHCAixZQEXWYhDeuXMnyLsVlEQKI45qFBQZ8eRECi4DBaAlDqle/8A48ip6gAADANdQY88Uc0oGAAAAAElFTkSuQmCC"/>
            <span>
                {% if collector.getLocated()|length %}↑ {{ collector.getLocated()|length }}{% endif %}
                {% if collector.getStored()|length %}↓ {{ collector.getStored()|length }}{% endif%}
            </span>
        {% endset %}
        {% include 'WebProfilerBundle:Profiler:toolbar_item.html.twig' with { 'link': profiler_url } %}
    {% endif %}
{% endblock %}

{% block menu %}
    <span class="label">
        <span class="icon"><img src="{{ asset('bundles/webprofiler/images/profiler/db.png') }}" alt="" /></span>
        <strong>Media Storage</strong>
        <span class="count">
            {% if collector.getLocated()|length %}<span>↑ {{ collector.getLocated()|length }}</span>{% endif %}
            {% if collector.getStored()|length %}<span>↓ {{ collector.getStored()|length }}</span>{% endif%}
        </span>
    </span>
{% endblock %}

{% block panel %}
    {% if collector.getLocated()|length or collector.getStored()|length %}
        {% if collector.getLocated()|length %}
            <h2>Located ({{ collector.getLocated()|length }})</h2>
            {% if collector.cacheHits %}<p><em>{{ collector.cacheHits }} files has been loaded from the cache.</em></p>{% endif %}
            <table>
                <thead>
                    <tr>
                        <th>Preview</th>
                        <th>Id</th>
                        <th>Filename</th>
                        <th>Type</th>
                        <th>Variant</th>
                        <th>Path</th>
                        <th>Times loaded</th>
                    </tr>
                </thead>
                <tbody>
                    {% for located in collector.located %}
                    <tr>
                        <td>
                            <a href="{{ located.path }}">
                                {% if located.isImage %}
                                    <img src="{{ located.path }}" alt="preview" width="28" title="Click to view the file"/>
                                {% else %}
                                    (Link)
                                {% endif %}
                            </a>
                        </td>
                        <td>{{ located.id }}</td>
                        <td>{{ located.name }}</td>
                        <td>{{ located.type }}</td>
                        <td>{{ located.variant|default('-') }}</td>
                        <td>{{ located.path }}</td>
                        <td>{{ located.hits }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% endif %}

        {% if collector.getStored()|length %}
            <h2>Stored ({{ collector.getStored()|length }})</h2>
            <table>
                <thead>
                    <tr>
                        <th>Source</th>
                        <th>Id</th>
                        <th>Filename</th>
                        <th>Type</th>
                        <th>Variant</th>
                    </tr>
                </thead>
                <tbody>
                {% for stored in collector.stored %}
                    <tr>
                        <td>{{ stored.source }}</td>
                        <td>{{ stored.id }}</td>
                        <td>{{ stored.name }}</td>
                        <td>{{ stored.type }}</td>
                        <td>{{ stored.variant|default('-') }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        {% endif %}
    {% else %}
        <p>Media storage has not been used for this request</p>
    {% endif %}
{% endblock %}